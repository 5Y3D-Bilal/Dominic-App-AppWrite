import PostStats from "@/components/Shared/PostStats";
import { Button } from "@/components/ui/button";
import { useUserContext } from "@/context/AuthContext";
import { useGetPostById } from "@/lib/react-query/querysAndMutitations";
import { formatDateString } from "@/lib/utils";
import { Link, useParams } from "react-router-dom";

const PostDetails = () => {
  const { id } = useParams();
  const { data: post, isPending } = useGetPostById(id || "");
  const { user } = useUserContext();
  const handleDeletePost = () => {};

  return (
    <div className="post_details-container">
      {isPending ? (
        <img src="assets/images/loader.svg" />
      ) : (
        <div className="post_details-card">
          <img
            src={post?.imageUrl}
            alt="posted image"
            className="post_details-img"
          />
          <div className="post_details-info">
            <div className="flex-between w-full">
              <Link
                to={`/profile/${post?.creator.$id}`}
                className="flex items-center gap-3"
              >
                <img
                  src={
                    post?.creator?.imageUrl ||
                    "https://cdn4.iconfinder.com/data/icons/avatars-21/512/avatar-circle-human-female-4-1024.png"
                  }
                  alt="creator"
                  className="rounded-full w-10 h-10 "
                />

                <div className="flex flex-col">
                  <p className="base-medium lg:body-bold text-light-1">
                    {post?.creator.name}
                  </p>
                  <div className="flex-center gap-2 text-light-3">
                    <p className="subtle-semibold lg:small-regular">
                      {formatDateString(post?.creator.$createdAt)}
                    </p>
                    -
                    <p className="subtle-semibold lg:small-regular">
                      {post?.location}
                    </p>
                  </div>
                </div>
              </Link>

              <div className="flex-center gap-4 ">
                <Link
                  to={`/update-post/${post?.$id}`}
                  className={`${user.id !== post?.creator.$id && "hidden"}`}
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 36 36"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M17.9139 1.875H20.25C20.8713 1.875 21.375 2.37868 21.375 3C21.375 3.62132 20.8713 4.125 20.25 4.125H18C14.4327 4.125 11.8703 4.12739 9.92036 4.38956C8.00276 4.64737 6.84668 5.13771 5.99219 5.99219C5.13771 6.84668 4.64737 8.00276 4.38956 9.92036C4.12739 11.8703 4.125 14.4327 4.125 18C4.125 21.5673 4.12739 24.1297 4.38956 26.0796C4.64737 27.9972 5.13771 29.1533 5.99219 30.0078C6.84668 30.8623 8.00276 31.3526 9.92036 31.6104C11.8703 31.8726 14.4327 31.875 18 31.875C21.5673 31.875 24.1297 31.8726 26.0796 31.6104C27.9972 31.3526 29.1533 30.8623 30.0078 30.0078C30.8623 29.1533 31.3526 27.9972 31.6104 26.0796C31.8726 24.1297 31.875 21.5673 31.875 18V15.75C31.875 15.1287 32.3787 14.625 33 14.625C33.6213 14.625 34.125 15.1287 34.125 15.75V18.0861C34.125 21.5487 34.125 24.2622 33.8404 26.3794C33.549 28.5465 32.941 30.2566 31.5988 31.5988C30.2566 32.941 28.5465 33.549 26.3794 33.8404C24.2622 34.125 21.5487 34.125 18.0861 34.125H17.9139C14.4513 34.125 11.7378 34.125 9.62056 33.8404C7.45345 33.549 5.74342 32.941 4.4012 31.5988C3.05899 30.2566 2.45098 28.5465 2.15962 26.3794C1.87497 24.2622 1.87498 21.5487 1.875 18.0861V17.9139C1.87498 14.4513 1.87497 11.7378 2.15962 9.62056C2.45098 7.45345 3.05899 5.74342 4.4012 4.4012C5.74342 3.05899 7.45345 2.45098 9.62056 2.15962C11.7378 1.87497 14.4513 1.87498 17.9139 1.875ZM25.1558 3.41387C27.2076 1.36204 30.5343 1.36204 32.5861 3.41387C34.638 5.4657 34.638 8.79237 32.5861 10.8442L22.614 20.8164C22.0571 21.3734 21.7082 21.7223 21.3189 22.0259C20.8603 22.3836 20.3642 22.6902 19.8392 22.9404C19.3935 23.1528 18.9254 23.3088 18.1782 23.5578L13.8214 25.0101C13.017 25.2782 12.1302 25.0689 11.5307 24.4693C10.9311 23.8698 10.7218 22.983 10.9899 22.1786L12.4422 17.8218C12.6912 17.0746 12.8472 16.6065 13.0596 16.1608C13.3098 15.6358 13.6164 15.1397 13.9741 14.6811C14.2777 14.2918 14.6267 13.9429 15.1837 13.386L25.1558 3.41387ZM30.9951 5.00486C29.822 3.83171 27.9199 3.83171 26.7468 5.00486L26.1819 5.56979C26.2159 5.71359 26.2635 5.88491 26.3298 6.076C26.5448 6.69558 26.9516 7.51157 27.72 8.27999C28.4884 9.04841 29.3044 9.4552 29.924 9.67015C30.1151 9.73645 30.2864 9.78409 30.4302 9.81814L30.9951 9.25321C32.1683 8.08006 32.1683 6.17801 30.9951 5.00486ZM28.6577 11.5906C27.8838 11.2578 26.9822 10.7242 26.129 9.87098C25.2758 9.01777 24.7422 8.11623 24.4094 7.34228L16.8263 14.9254C16.2015 15.5502 15.9565 15.7979 15.7482 16.0649C15.4911 16.3946 15.2706 16.7513 15.0907 17.1288C14.945 17.4344 14.833 17.7644 14.5536 18.6026L13.9058 20.5461L15.4539 22.0942L17.3974 21.4464C18.2356 21.167 18.5656 21.0549 18.8712 20.9093C19.2487 20.7294 19.6054 20.5089 19.9351 20.2518C20.2021 20.0435 20.4498 19.7985 21.0746 19.1737L28.6577 11.5906Z"
                      fill="#877EFF"
                    />
                  </svg>
                </Link>

                <Button
                  onClick={handleDeletePost}
                  variant="ghost"
                  className={`ghost_details-delete_btn ${
                    user.id !== post?.creator.$id && "hidden"
                  }`}
                >
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 20 20"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M4.26401 6.45975C4.60842 6.43679 4.90624 6.69738 4.9292 7.04179L5.31248 12.7911C5.38737 13.9143 5.44072 14.6958 5.55786 15.2838C5.67149 15.8542 5.8301 16.1561 6.05794 16.3692C6.28579 16.5824 6.59758 16.7206 7.17425 16.796C7.76875 16.8738 8.55209 16.875 9.67779 16.875H10.3223C11.448 16.875 12.2313 16.8738 12.8258 16.796C13.4025 16.7206 13.7143 16.5824 13.9421 16.3692C14.17 16.1561 14.3286 15.8542 14.4422 15.2838C14.5593 14.6958 14.6127 13.9143 14.6876 12.7911L15.0709 7.04179C15.0938 6.69738 15.3916 6.43679 15.736 6.45975C16.0805 6.48271 16.3411 6.78053 16.3181 7.12494L15.9319 12.9181C15.8606 13.987 15.8031 14.8505 15.6681 15.528C15.5278 16.2324 15.2891 16.8208 14.7961 17.2821C14.3031 17.7433 13.7001 17.9423 12.9879 18.0355C12.3029 18.1251 11.4375 18.125 10.3662 18.125H9.63385C8.56252 18.125 7.69716 18.1251 7.01212 18.0355C6.29991 17.9423 5.69696 17.7433 5.20396 17.2821C4.71097 16.8208 4.47228 16.2324 4.33195 15.528C4.19697 14.8505 4.13942 13.987 4.06818 12.9181L3.68197 7.12494C3.65901 6.78053 3.9196 6.48271 4.26401 6.45975Z"
                      fill="#FF5050"
                    />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8.62941 1.87503L8.5911 1.87502C8.41077 1.8749 8.25367 1.8748 8.10532 1.89849C7.51923 1.99208 7.01207 2.35762 6.73795 2.88403C6.66856 3.01728 6.61897 3.16636 6.56206 3.33747L6.54996 3.37382L6.46905 3.61654C6.45323 3.66401 6.44882 3.67709 6.44498 3.6877C6.29905 4.09113 5.9207 4.36383 5.49182 4.3747C5.48054 4.37498 5.46673 4.37503 5.4167 4.37503H2.91663C2.57145 4.37503 2.29163 4.65485 2.29163 5.00003C2.29163 5.34521 2.57145 5.62503 2.91663 5.62503L5.42383 5.62503L5.43778 5.62503H14.5623L14.5762 5.62503L17.0834 5.62503C17.4285 5.62503 17.7084 5.34521 17.7084 5.00003C17.7084 4.65485 17.4285 4.37503 17.0834 4.37503H14.5834C14.5333 4.37503 14.5195 4.37498 14.5082 4.3747C14.0794 4.36383 13.701 4.09111 13.5551 3.68768C13.5513 3.67715 13.5468 3.66378 13.531 3.61654L13.4501 3.37382L13.438 3.33745C13.3811 3.16634 13.3315 3.01727 13.2621 2.88403C12.988 2.35762 12.4808 1.99208 11.8947 1.89849C11.7464 1.8748 11.5893 1.8749 11.409 1.87502L11.3706 1.87503H8.62941ZM7.62044 4.1129C7.58771 4.20337 7.54968 4.29085 7.50675 4.37503H12.4933C12.4504 4.29085 12.4123 4.20338 12.3796 4.11292L12.3474 4.01846L12.2642 3.7691C12.1883 3.54117 12.1708 3.49469 12.1534 3.46137C12.0621 3.2859 11.893 3.16405 11.6976 3.13285C11.6605 3.12693 11.6109 3.12503 11.3706 3.12503H8.62941C8.38915 3.12503 8.33953 3.12693 8.30242 3.13285C8.10706 3.16405 7.93801 3.2859 7.84663 3.46137C7.82928 3.49469 7.81179 3.54118 7.73581 3.7691L7.65264 4.01861C7.64012 4.05619 7.63038 4.08543 7.62044 4.1129Z"
                      fill="#FF5050"
                    />
                  </svg>
                </Button>
              </div>
            </div>
            <hr className="border w-full border-dark-4/80" />
            <div className="flex flex-col flex-1 w-full small-medium lg:base-regular">
              <p>{post?.caption}</p>
              <ul className="flex gap-1 mt-2">
                {post?.tags.map((tag: string) => (
                  <li key={post?.tag}>#{tag}</li>
                ))}
              </ul>
            </div>

            <div className="w-full ">
              <PostStats post={post} userId={user.id} />
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PostDetails;
